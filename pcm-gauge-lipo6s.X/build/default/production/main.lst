MPASM  5.52  /HOME/KWENDENARMO/MPLABXPROJECTS   10-18-2013  21:32:48         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001     LIST        P=PIC12F683          ; list directive to define processor
                      00002     #INCLUDE    <p12f683.inc>         ; processor specific variable definitions
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ;  MPASM PIC12F683 processor include
                      00005 ; 
                      00006 ;  (c) Copyright 1999-2013 Microchip Technology, All rights reserved
                      00007 ;==========================================================================
                      00008 
                      00459         LIST
                      00003 
                      00004 
                      00005 ; CONFIG
                      00006 ; __config 0xF0C4
2007   30C4           00007  __CONFIG _FOSC_INTOSCIO & _WDTE_OFF & _PWRTE_ON & _MCLRE_OFF & _CP_OFF & _CPD_OFF & _BOREN_OFF & _IESO_
                            OFF & _FCMEN_OFF
                      00008 
                      00009 ;Pinout
                      00010 ;   GP0/AN0 <- ADC  Volt (voltage divider 8.5:1)
                      00011 ;   GP1/AN1 <- ADC  Temp (LM35)
                      00012 ;   GP2     -> PWM  buzzer (without osc)
                      00013 ;   GP4     -> GPIO LED Warn
                      00014 ;   GP5     -> GPIO LED ok
                      00015 
                      00016 
  00000093            00017 Max_Volt    equ     0x93                ;  limite superior ADC0 (4.2 -> 25.2)
  0000006E            00018 Min_Volt    equ     0x6E                ;  limite inferior ADC0 (3.1 -> 18.6)
  00000026            00019 Max_Temp    equ     0x26                ;  limite superior ADC1 (75º)
  00000093            00020 G_100       equ     0x93                ; 100%
  00000090            00021 G_083       equ     0x90                ; 83%
  0000008C            00022 G_066       equ     0x8C                ; 66%
  00000087            00023 G_050       equ     0x87                ; 50%
  00000082            00024 G_033       equ     0x82                ; 33%
  0000007B            00025 G_016       equ     0x7B                ; 16%
  00000071            00026 G_000       equ     0x71                ; 0%
                      00027 
                      00028     CBLOCK 0x3E                             ;  posiciones sólo en banco 0
  0000003E            00029     ADC0_LPFReg1                           ;  no mover de posición los registros LPF, posiciones fijas d
                            el 0x3E al 0x4D
  0000003F            00030     ADC0_LPFReg2                           ;  se usa direccionamiento indirecto
  00000040            00031     ADC0_LPFReg3
  00000041            00032     ADC0_LPFReg4
  00000042            00033     ADC0_LPFReg5
  00000043            00034     ADC0_LPFReg6
  00000044            00035     ADC0_LPFReg7
  00000045            00036     ADC0_LPFReg8
  00000046            00037     ADC0_LPFReg9
  00000047            00038     ADC0_LPFReg10
  00000048            00039     ADC0_LPFReg11
  00000049            00040     ADC0_LPFReg12
  0000004A            00041     ADC0_LPFReg13
  0000004B            00042     ADC0_LPFReg14
MPASM  5.52  /HOME/KWENDENARMO/MPLABXPROJECTS   10-18-2013  21:32:48         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  0000004C            00043     ADC0_LPFReg15
  0000004D            00044     ADC0_LPFReg16
  0000004E            00045     ADC0_Accumulator_HI
  0000004F            00046     ADC0_Accumulator_LO
                      00047     ENDC
                      00048 
                      00049     CBLOCK 0x5E                             ;  posiciones sólo en banco 0
  0000005E            00050     ADC1_LPFReg1                           ;  no mover de posición los registros LPF, posiciones fijas d
                            el 0x5E al 0x6D
  0000005F            00051     ADC1_LPFReg2                           ;  se usa direccionamiento indirecto
  00000060            00052     ADC1_LPFReg3
  00000061            00053     ADC1_LPFReg4
  00000062            00054     ADC1_LPFReg5
  00000063            00055     ADC1_LPFReg6
  00000064            00056     ADC1_LPFReg7
  00000065            00057     ADC1_LPFReg8
  00000066            00058     ADC1_LPFReg9
  00000067            00059     ADC1_LPFReg10
  00000068            00060     ADC1_LPFReg11
  00000069            00061     ADC1_LPFReg12
  0000006A            00062     ADC1_LPFReg13
  0000006B            00063     ADC1_LPFReg14
  0000006C            00064     ADC1_LPFReg15
  0000006D            00065     ADC1_LPFReg16
  0000006E            00066     ADC1_Accumulator_HI
  0000006F            00067     ADC1_Accumulator_LO
                      00068     ENDC
                      00069 
                      00070     CBLOCK 0x70                             ;  posiciones comunes en bancos
  00000070            00071     W_ISR
  00000071            00072     STATUS_ISR
  00000072            00073     ALARM_STAT
  00000073            00074     DLoop1
  00000074            00075     DLoop2
  00000075            00076     DLoop3
  00000076            00077     TmCount
  00000077            00078     Dutycycle_ADC0
  00000078            00079     Dutycycle_ADC1
  00000079            00080     Dutycycle_HI
  0000007A            00081     Dutycycle_LO
  0000007B            00082     Aux
                      00083     ENDC
                      00084 
                      00085 ;------------------------------------------------------------------------------
                      00086 ; RESET VECTOR
                      00087 ;------------------------------------------------------------------------------
                      00088 RES_VECT    code    0x0000  ; processor reset vector
0000   2???           00089     call    setup
0001   2???           00090     goto    main
                      00091 
                      00092 ISR_VECT    code    0x0004  ; processor isr vector
0004   2???           00093     goto    isr
                      00094 
MPASM  5.52  /HOME/KWENDENARMO/MPLABXPROJECTS   10-18-2013  21:32:48         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00095 ;------------------------------------------------------------------------------
                      00096 ; MAIN PROGRAM
                      00097 ;------------------------------------------------------------------------------
                      00098 MAIN_PROG   code            ; let linker place main program
                      00099 
                      00100 ; TODO asegurar bancos
                      00101 
0000                  00102 isr                         ; each ~8s
                      00103 ;interrupción TIMER0
0000   00F0           00104     movwf   W_ISR                           ;  guardar estado
0001   0E03           00105     swapf   STATUS,W
0002   00F1           00106     movwf   STATUS_ISR
0003   0AF6           00107     incf    TmCount,F                  ;count 255 interrupts
0004   1903           00108     btfsc   STATUS,Z
0005   1472           00109     bsf     ALARM_STAT,0                ;then print
0006   1283           00110     banksel INTCON                          ;  desactivar flag de interrupción
0007   110B           00111     bcf     INTCON,T0IF
0008   0E71           00112     swapf   STATUS_ISR,W                    ;  recuperar estado
0009   0083           00113     movwf   STATUS
000A   0EF0           00114     swapf   W_ISR,F
000B   0E70           00115     swapf   W_ISR,W
000C   0009           00116     retfie
                      00117 
000D                  00118 setup
000D   1683           00119     banksel OSCCON
000E   3071           00120     movlw   0x71
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
000F   008F           00121     movwf   OSCCON
                      00122 ;configurar puertos
0010   1283           00123     banksel GPIO                            ;  inicializar puertos
0011   0185           00124     clrf    GPIO
0012   3007           00125     movlw   0x07                            ;  comparador off
0013   0099           00126     movwf   CMCON0
0014   1683           00127     banksel ANSEL                           ;  máscara a modulo adc
0015   3023           00128     movlw   0x23                            ;  selecciona AN1 con fs osc/32
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0016   009F           00129     movwf   ANSEL
0017   300F           00130     movlw   0x0F                            ;  configura todos los pines como entrada
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0018   0085           00131     movwf   TRISIO
                      00132 ;configurar PWM
0019   3037           00133     movlw   0x37                            ;  establece frecuencia PWM (1.22 KHz)
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
001A   0092           00134     movwf   PR2
001B   1283           00135     banksel CCP1CON                         ;  PWM modo activo a nivel alto
001C   300C           00136     movlw   0x0C
001D   0095           00137     movwf   CCP1CON
001E   0193           00138     clrf    CCPR1L                          ;  MS byte factor de servicio
001F   108C           00139     bcf     PIR1,TMR2IF                     ;  borra el flag de igualdad entre timer2 y pr2
0020   3007           00140     movlw   0x07                            ;  timer2 on, no postscaler, prescaler 16
0021   0092           00141     movwf   T2CON
0022   1C8C           00142     btfss   PIR1,TMR2IF                     ;  espera desbordamiento en timer2
0023   2???           00143     goto    $-1
MPASM  5.52  /HOME/KWENDENARMO/MPLABXPROJECTS   10-18-2013  21:32:48         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0024   1683           00144     banksel TRISIO                          ;  GPIO2 como salida
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0025   1105           00145     bcf     TRISIO,2
                      00146 ;configurar ADC y LPF
0026   1283           00147     banksel ADCON0                          ;  ADC on, AN0 seleccionado, MSB a la izquierda, Vdd como Vr
                            ef
0027   3001           00148     movlw   0x01                            ; 0x05 para adc1
0028   009F           00149     movwf   ADCON0
0029   2???           00150     call    Delay_4us                       ;  retardo de adquisición
002A   149F           00151     bsf     ADCON0,GO                       ;  inicia ciclo de ADC
002B   189F           00152     btfsc   ADCON0,GO                       ;  espera hasta que complete el ciclo
002C   2???           00153     goto    $-1                             ;  se desecha la primera lectura
002D   149F           00154     bsf     ADCON0,GO                       ;  inicia ciclo del ADC
002E   189F           00155     btfsc   ADCON0,GO                       ;  espera hasta que complete el ciclo
002F   2???           00156     goto    $-1
0030   081E           00157     movf    ADRESH,W                        ;  lee el MS byte del ADC
0031   00BE           00158     movwf   ADC0_LPFReg1                    ;  inicializa los registros del LPF con el valor leído
0032   00BF           00159     movwf   ADC0_LPFReg2
0033   00C0           00160     movwf   ADC0_LPFReg3
0034   00C1           00161     movwf   ADC0_LPFReg4
0035   00C2           00162     movwf   ADC0_LPFReg5
0036   00C3           00163     movwf   ADC0_LPFReg6
0037   00C4           00164     movwf   ADC0_LPFReg7
0038   00C5           00165     movwf   ADC0_LPFReg8
0039   00C6           00166     movwf   ADC0_LPFReg9
003A   00C7           00167     movwf   ADC0_LPFReg10
003B   00C8           00168     movwf   ADC0_LPFReg11
003C   00C9           00169     movwf   ADC0_LPFReg12
003D   00CA           00170     movwf   ADC0_LPFReg13
003E   00CB           00171     movwf   ADC0_LPFReg14
003F   00CC           00172     movwf   ADC0_LPFReg15
0040   00CD           00173     movwf   ADC0_LPFReg16
0041   01CF           00174     clrf    ADC0_Accumulator_LO                  ;  inicializa el acumulador de LPF
0042   01CE           00175     clrf    ADC0_Accumulator_HI
0043   3005           00176     movlw   0x05
0044   009F           00177     movwf   ADCON0
0045   2???           00178     call    Delay_4us                       ;  retardo de adquisición
0046   149F           00179     bsf     ADCON0,GO                       ;  inicia ciclo de ADC
0047   189F           00180     btfsc   ADCON0,GO                       ;  espera hasta que complete el ciclo
0048   2???           00181     goto    $-1
0049   081E           00182     movf    ADRESH,W                        ;  lee el MS byte del ADC
004A   00DE           00183     movwf   ADC1_LPFReg1                    ;  inicializa los registros del LPF con el valor leído
004B   00DF           00184     movwf   ADC1_LPFReg2
004C   00E0           00185     movwf   ADC1_LPFReg3
004D   00E1           00186     movwf   ADC1_LPFReg4
004E   00E2           00187     movwf   ADC1_LPFReg5
004F   00E3           00188     movwf   ADC1_LPFReg6
0050   00E4           00189     movwf   ADC1_LPFReg7
0051   00E5           00190     movwf   ADC1_LPFReg8
0052   00E6           00191     movwf   ADC1_LPFReg9
0053   00E7           00192     movwf   ADC1_LPFReg10
0054   00E8           00193     movwf   ADC1_LPFReg11
0055   00E9           00194     movwf   ADC1_LPFReg12
MPASM  5.52  /HOME/KWENDENARMO/MPLABXPROJECTS   10-18-2013  21:32:48         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0056   00EA           00195     movwf   ADC1_LPFReg13
0057   00EB           00196     movwf   ADC1_LPFReg14
0058   00EC           00197     movwf   ADC1_LPFReg15
0059   00ED           00198     movwf   ADC1_LPFReg16
005A   01EF           00199     clrf    ADC1_Accumulator_LO                  ;  inicializa el acumulador de LPF
005B   01EE           00200     clrf    ADC1_Accumulator_HI
                      00201 ;configurar interrupciones
005C   30A0           00202     movlw   0xA0                            ;  habilita interrupción por TIMER0
005D   008B           00203     movwf   INTCON
                      00204 ;configurar TIMER0
005E   1683           00205     banksel OPTION_REG                      ;  prescaler 256 a TIMER0 (interrupción cada ~32ms)
005F   3087           00206     movlw   0x87
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0060   0081           00207     movwf   OPTION_REG
0061   1283           00208     banksel TMR0                            ;  precarga de TIMER0 e inicio
0062   3000           00209     movlw   0x00
0063   0081           00210     movwf   TMR0
                      00211 ;valores iniciales variables
0064   01F2           00212     clrf    ALARM_STAT
0065   0008           00213     return
                      00214 
0066                  00215 main                        ; main code
0066   1283           00216     banksel GPIO            ; lamp test & beep
0067   1605           00217     bsf     GPIO,4
0068   1685           00218     bsf     GPIO,5
0069   303F           00219     movlw   0x3F
006A   2???           00220     call    Set_Dutycycle
006B   2???           00221     call    Delay_250ms
006C   1205           00222     bcf     GPIO,4
006D   1285           00223     bcf     GPIO,5
006E   3000           00224     movlw   0x00
006F   2???           00225     call    Set_Dutycycle
0070   2???           00226     call    Delay_250ms             ; delay
0071   2???           00227     call    Delay_250ms
0072   2???           00228     call    Delay_250ms
0073   2???           00229     call    Delay_250ms
0074   081F           00230     movf    ADCON0,W                        ; fuel gauge
0075   39F3           00231     andlw   0xF3
0076   009F           00232     movwf   ADCON0
0077   2???           00233     call    Delay_4us
0078   149F           00234     bsf     ADCON0,GO
0079   189F           00235     btfsc   ADCON0,GO
007A   2???           00236     goto    $-1
007B   2???           00237     call    Delay_4us
007C   081E           00238     movf    ADRESH,W
007D   00F7           00239     movwf   Dutycycle_ADC0
007E   0000           00240     nop
007F   0877           00241     movf    Dutycycle_ADC0,W        ;v<=16%
0080   3C7B           00242     sublw   G_016
0081   1803           00243     btfsc   STATUS,C
0082   2???           00244     goto    $+0x1F
0083   0877           00245     movf    Dutycycle_ADC0,W        ;v<=33%
0084   3C82           00246     sublw   G_033
MPASM  5.52  /HOME/KWENDENARMO/MPLABXPROJECTS   10-18-2013  21:32:48         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0085   1803           00247     btfsc   STATUS,C
0086   2???           00248     goto    $+0x1F
0087   0877           00249     movf    Dutycycle_ADC0,W        ;v<=50%
0088   3C87           00250     sublw   G_050
0089   1803           00251     btfsc   STATUS,C
008A   2???           00252     goto    $+0x1F
008B   0877           00253     movf    Dutycycle_ADC0,W        ;v<=66%
008C   3C8C           00254     sublw   G_066
008D   1803           00255     btfsc   STATUS,C
008E   2???           00256     goto    $+0x0E
008F   0877           00257     movf    Dutycycle_ADC0,W        ;v<=83%
0090   3C90           00258     sublw   G_083
0091   1803           00259     btfsc   STATUS,C
0092   2???           00260     goto    $+6
0093   0000           00261     nop                             ;v>83%
0094   1685           00262     bsf     GPIO,5                  ;ggg
0095   2???           00263     call    Delay_250ms
0096   1285           00264     bcf     GPIO,5
0097   2???           00265     call    Delay_250ms
0098   1685           00266     bsf     GPIO,5                  ;gg
0099   2???           00267     call    Delay_250ms
009A   1285           00268     bcf     GPIO,5
009B   2???           00269     call    Delay_250ms
009C   1685           00270     bsf     GPIO,5                  ;g
009D   2???           00271     call    Delay_250ms
009E   1285           00272     bcf     GPIO,5
009F   2???           00273     call    Delay_250ms
00A0   2???           00274     goto    $+0x0D
00A1   1605           00275     bsf     GPIO,4                  ;rrr
00A2   2???           00276     call    Delay_250ms
00A3   1205           00277     bcf     GPIO,4
00A4   2???           00278     call    Delay_250ms
00A5   1605           00279     bsf     GPIO,4                  ;rr
00A6   2???           00280     call    Delay_250ms
00A7   1205           00281     bcf     GPIO,4
00A8   2???           00282     call    Delay_250ms
00A9   1605           00283     bsf     GPIO,4                  ;r
00AA   2???           00284     call    Delay_250ms
00AB   1205           00285     bcf     GPIO,4
00AC   2???           00286     call    Delay_250ms
00AD   2???           00287     call    Delay_250ms             ; delay
00AE   2???           00288     call    Delay_250ms
00AF   2???           00289     call    Delay_250ms
00B0   2???           00290     call    Delay_250ms
00B1   1072           00291     bcf     ALARM_STAT,0
00B2                  00292 loop
00B2   1C72           00293     btfss   ALARM_STAT,0
00B3   2???           00294     goto    $+0x13
00B4   0103           00295     clrw
00B5   0872           00296     movf    ALARM_STAT,W        ;if ALARM_STAT,0 == HIGH -> print
00B6   390E           00297     andlw   0x0E
00B7   1903           00298     btfsc   STATUS,Z
00B8   2???           00299     goto    $+3
MPASM  5.52  /HOME/KWENDENARMO/MPLABXPROJECTS   10-18-2013  21:32:48         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00B9   1605           00300     bsf     GPIO,4
00BA   2???           00301     goto    $+2
00BB   1685           00302     bsf     GPIO,5
00BC   2???           00303     call    Delay_250ms
00BD   1205           00304     bcf     GPIO,4
00BE   1285           00305     bcf     GPIO,5
00BF   18F2           00306     btfsc   ALARM_STAT,1
00C0   2???           00307     call    Alarm_VMin
00C1   1972           00308     btfsc   ALARM_STAT,2
00C2   2???           00309     call    Alarm_VMax
00C3   19F2           00310     btfsc   ALARM_STAT,3
00C4   2???           00311     call    Alarm_TMax
00C5   1072           00312     bcf     ALARM_STAT,0
00C6   3001           00313     movlw   0x01
00C7   05F2           00314     andwf   ALARM_STAT,F
00C8   2???           00315     call    LPF_ADC_Read
00C9   0877           00316     movf    Dutycycle_ADC0,W        ;process read
00CA   3C93           00317     sublw   Max_Volt
00CB   1C03           00318     btfss   STATUS,C
00CC   2???           00319     goto    $+0x0A
00CD   0877           00320     movf    Dutycycle_ADC0,W
00CE   3C6E           00321     sublw   Min_Volt
00CF   1803           00322     btfsc   STATUS,C
00D0   2???           00323     goto    $+8
00D1   0878           00324     movf    Dutycycle_ADC1,W
00D2   3C26           00325     sublw   Max_Temp
00D3   1C03           00326     btfss   STATUS,C
00D4   2???           00327     goto    $+6
00D5   2???           00328     goto    loop
00D6   1572           00329     bsf     ALARM_STAT,2        ;vmax
00D7   2???           00330     goto    loop
00D8   14F2           00331     bsf     ALARM_STAT,1        ;vmin
00D9   2???           00332     goto    loop
00DA   15F2           00333     bsf     ALARM_STAT,3       ;tmax
00DB   2???           00334     goto    loop
                      00335 
00DC                  00336 Alarm_VMin
00DC   301F           00337     movlw   0x1F
00DD   2???           00338     call    Set_Dutycycle
00DE   2???           00339     call    Delay_75ms
00DF   3000           00340     movlw   0x00
00E0   2???           00341     call    Set_Dutycycle
00E1   2???           00342     call    Delay_75ms
00E2   1683           00343     banksel PR2
00E3   3045           00344     movlw   0x45
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00E4   0092           00345     movwf   PR2
00E5   1283           00346     banksel GPIO
00E6   301F           00347     movlw   0x1F
00E7   2???           00348     call    Set_Dutycycle
00E8   2???           00349     call    Delay_75ms
00E9   3000           00350     movlw   0x00
00EA   2???           00351     call    Set_Dutycycle
MPASM  5.52  /HOME/KWENDENARMO/MPLABXPROJECTS   10-18-2013  21:32:48         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00EB   2???           00352     call    Delay_75ms
00EC   1683           00353     banksel PR2
00ED   3037           00354     movlw   0x37
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00EE   0092           00355     movwf   PR2
00EF   1283           00356     banksel GPIO
00F0   301F           00357     movlw   0x1F
00F1   2???           00358     call    Set_Dutycycle
00F2   2???           00359     call    Delay_75ms
00F3   3000           00360     movlw   0x00
00F4   2???           00361     call    Set_Dutycycle
00F5   0008           00362     return
                      00363 
00F6                  00364 Alarm_VMax
00F6   1683           00365     banksel PR2
00F7   3045           00366     movlw   0x45
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00F8   0092           00367     movwf   PR2
00F9   1283           00368     banksel GPIO
00FA   301F           00369     movlw   0x1F
00FB   2???           00370     call    Set_Dutycycle
00FC   2???           00371     call    Delay_75ms
00FD   3000           00372     movlw   0x00
00FE   2???           00373     call    Set_Dutycycle
00FF   2???           00374     call    Delay_75ms
0100   301F           00375     movlw   0x1F
0101   2???           00376     call    Set_Dutycycle
0102   2???           00377     call    Delay_75ms
0103   3000           00378     movlw   0x00
0104   2???           00379     call    Set_Dutycycle
0105   2???           00380     call    Delay_75ms
0106   1683           00381     banksel PR2
0107   3037           00382     movlw   0x37
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0108   0092           00383     movwf   PR2
0109   1283           00384     banksel GPIO
010A   301F           00385     movlw   0x1F
010B   2???           00386     call    Set_Dutycycle
010C   2???           00387     call    Delay_75ms
010D   3000           00388     movlw   0x00
010E   2???           00389     call    Set_Dutycycle
010F   0008           00390     return
                      00391 
0110                  00392 Alarm_TMax
0110   301F           00393     movlw   0x1F
0111   2???           00394     call    Set_Dutycycle
0112   2???           00395     call    Delay_75ms
0113   3000           00396     movlw   0x00
0114   2???           00397     call    Set_Dutycycle
0115   2???           00398     call    Delay_75ms
0116   301F           00399     movlw   0x1F
0117   2???           00400     call    Set_Dutycycle
0118   2???           00401     call    Delay_75ms
MPASM  5.52  /HOME/KWENDENARMO/MPLABXPROJECTS   10-18-2013  21:32:48         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0119   3000           00402     movlw   0x00
011A   2???           00403     call    Set_Dutycycle
011B   2???           00404     call    Delay_75ms
011C   301F           00405     movlw   0x1F
011D   2???           00406     call    Set_Dutycycle
011E   2???           00407     call    Delay_75ms
011F   3000           00408     movlw   0x00
0120   2???           00409     call    Set_Dutycycle
0121   0008           00410     return
                      00411 
0122                  00412 LPF_ADC_Read
                      00413 ;ADC0 - volts
                      00414     ;Desplazamiento de registros
0122   304C           00415     movlw   0x4C                            ;  desplaza los registros LPF
0123   0084           00416     movwf   FSR
0124   0800           00417     movf    INDF,W
0125   0A84           00418     incf    FSR,F
0126   0080           00419     movwf   INDF
0127   1F04           00420     btfss   FSR,6                           ;  es el ultimo desplazamiento?
0128   2???           00421     goto    $+4                             ;  si a acabado salta
0129   0384           00422     decf    FSR,F                           ;  si no direcciona el siguiente registro y vuelve al bucle
012A   0384           00423     decf    FSR,F
012B   2???           00424     goto    $-7
                      00425     ;Lectura del ADC
012C   081F           00426     movf    ADCON0,W                        ; ADC0
012D   39F3           00427     andlw   0xF3
012E   009F           00428     movwf   ADCON0
012F   2???           00429     call    Delay_4us
0130   149F           00430     bsf     ADCON0,GO                       ;  inicia ciclo del ADC
0131   189F           00431     btfsc   ADCON0,GO                       ;  espera hasta que complete el ciclo
0132   2???           00432     goto    $-1
0133   2???           00433     call    Delay_4us
0134   081E           00434     movf    ADRESH,W                        ;  lee el MS byte del ADC
0135   00BE           00435     movwf   ADC0_LPFReg1
                      00436     ;Cálculo del LPF
0136   083E           00437     movf    ADC0_LPFReg1,W                 ;  inicia el cálculo
0137   00CF           00438     movwf   ADC0_Accumulator_LO                  ;  el acumulador es el sumatorio de los registros
0138   304E           00439     movlw   0x4E
0139   0084           00440     movwf   FSR
013A   0384           00441     decf    FSR,F
013B   0800           00442     movf    INDF,W
013C   07CF           00443     addwf   ADC0_Accumulator_LO,F
013D   1803           00444     btfsc   STATUS,C                        ;  si el acumulador desborda, +1 al MSByte
013E   0ACE           00445     incf    ADC0_Accumulator_HI,F
013F   1B04           00446     btfsc   FSR,6                           ;  comprueba si ha sumado todos los registros
0140   2???           00447     goto    $-6
0141   0CCF           00448     rrf     ADC0_Accumulator_LO,F                ;  división entre 16
0142   0CCF           00449     rrf     ADC0_Accumulator_LO,F
0143   0CCF           00450     rrf     ADC0_Accumulator_LO,F
0144   0C4F           00451     rrf     ADC0_Accumulator_LO,W
0145   390F           00452     andlw   0x0F
0146   00CF           00453     movwf   ADC0_Accumulator_LO
0147   0E4E           00454     swapf   ADC0_Accumulator_HI,W
MPASM  5.52  /HOME/KWENDENARMO/MPLABXPROJECTS   10-18-2013  21:32:48         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0148   39F0           00455     andlw   0xF0
0149   04CF           00456     iorwf   ADC0_Accumulator_LO,F
014A   084F           00457     movf    ADC0_Accumulator_LO,W
014B   00F7           00458     movwf   Dutycycle_ADC0                   ;  mueve el resultado a la salida
014C   01CF           00459     clrf    ADC0_Accumulator_LO                  ;  limpia los registros para la siguiente ejecución
014D   01CE           00460     clrf    ADC0_Accumulator_HI
                      00461 ;ADC1 - temp
                      00462     ;Desplazamiento de registros
014E   306C           00463     movlw   0x6C                            ;  desplaza los registros LPF
014F   0084           00464     movwf   FSR
0150   0800           00465     movf    INDF,W
0151   0A84           00466     incf    FSR,F
0152   0080           00467     movwf   INDF
0153   1E84           00468     btfss   FSR,5                           ;  es el ultimo desplazamiento?
0154   2???           00469     goto    $+4                             ;  si a acabado salta
0155   0384           00470     decf    FSR,F                           ;  si no direcciona el siguiente registro y vuelve al bucle
0156   0384           00471     decf    FSR,F
0157   2???           00472     goto    $-7
                      00473     ;Lectura del ADC
0158   081F           00474     movf    ADCON0,W                        ; ADC1
0159   39F3           00475     andlw   0xF3
015A   3804           00476     iorlw   0x04
015B   009F           00477     movwf   ADCON0
015C   2???           00478     call    Delay_4us
015D   149F           00479     bsf     ADCON0,GO                       ;  inicia ciclo del ADC
015E   189F           00480     btfsc   ADCON0,GO                       ;  espera hasta que complete el ciclo
015F   2???           00481     goto    $-1
0160   2???           00482     call    Delay_4us
0161   081E           00483     movf    ADRESH,W                        ;  lee el MS byte del ADC
0162   00DE           00484     movwf   ADC1_LPFReg1
                      00485     ;Cálculo del LPF
0163   085E           00486     movf    ADC1_LPFReg1,W                 ;  inicia el cálculo
0164   00EF           00487     movwf   ADC1_Accumulator_LO                  ;  el acumulador es el sumatorio de los registros
0165   306E           00488     movlw   0x6E
0166   0084           00489     movwf   FSR
0167   0384           00490     decf    FSR,F
0168   0800           00491     movf    INDF,W
0169   07EF           00492     addwf   ADC1_Accumulator_LO,F
016A   1803           00493     btfsc   STATUS,C                        ;  si el acumulador desborda, +1 al MSByte
016B   0AEE           00494     incf    ADC1_Accumulator_HI,F
016C   1A84           00495     btfsc   FSR,5                           ;  comprueba si ha sumado todos los registros
016D   2???           00496     goto    $-6
016E   0CEF           00497     rrf     ADC1_Accumulator_LO,F                ;  división entre 16
016F   0CEF           00498     rrf     ADC1_Accumulator_LO,F
0170   0CEF           00499     rrf     ADC1_Accumulator_LO,F
0171   0C6F           00500     rrf     ADC1_Accumulator_LO,W
0172   390F           00501     andlw   0x0F
0173   00EF           00502     movwf   ADC1_Accumulator_LO
0174   0E6E           00503     swapf   ADC1_Accumulator_HI,W
0175   39F0           00504     andlw   0xF0
0176   04EF           00505     iorwf   ADC1_Accumulator_LO,F
0177   086F           00506     movf    ADC1_Accumulator_LO,W
0178   00F8           00507     movwf   Dutycycle_ADC1                   ;  mueve el resultado a la salida
MPASM  5.52  /HOME/KWENDENARMO/MPLABXPROJECTS   10-18-2013  21:32:48         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0179   01EF           00508     clrf    ADC1_Accumulator_LO                  ;  limpia los registros para la siguiente ejecución
017A   01EE           00509     clrf    ADC1_Accumulator_HI
017B   0008           00510     return
                      00511 
017C                  00512 Set_Dutycycle
017C   00F9           00513     movwf   Dutycycle_HI                    ;  se guarda en variable para el registro MS
017D   00FA           00514     movwf   Dutycycle_LO                    ;  se guarda en variable para el registro LS
017E   0CF9           00515     rrf     Dutycycle_HI,F                  ;  procesamiento para ajustar al registro MS
017F   0CF9           00516     rrf     Dutycycle_HI,F
0180   303F           00517     movlw   0x3F
0181   05F9           00518     andwf   Dutycycle_HI,F
0182   0EFA           00519     swapf   Dutycycle_LO,F                  ;  procesamiento para ajustar al registro LS
0183   3030           00520     movlw   0x30
0184   05FA           00521     andwf   Dutycycle_LO,F
0185   300C           00522     movlw   0x0C                            ;  máscara de bits establecidos en setup
0186   04FA           00523     iorwf   Dutycycle_LO,F
0187   0879           00524     movf    Dutycycle_HI,W                  ;  mueve el factor de servicio al registro MS
0188   0093           00525     movwf   CCPR1L
0189   087A           00526     movf    Dutycycle_LO,W                  ;  mueve el factor de servicio al registro LS
018A   0095           00527     movwf   CCP1CON
018B   0008           00528     return
                      00529 
018C                  00530 Delay_4us
018C   2???           00531     goto    $+1
018D   2???           00532     goto    $+1
018E   0008           00533     return
                      00534 
018F                  00535 Delay_75ms
018F   302E           00536         movlw   0x2E
0190   00F3           00537         movwf   DLoop1
0191   3076           00538         movlw   0x76
0192   00F4           00539         movwf   DLoop2
0193                  00540 Delay_75ms_0
0193   0BF3           00541         decfsz  DLoop1, f
0194   2???           00542         goto    $+2
0195   0BF4           00543         decfsz  DLoop2, f
0196   2???           00544         goto    Delay_75ms_0
0197   2???           00545         goto    $+1
0198   0000           00546         nop
0199   0008           00547         return
                      00548 
019A                  00549 Delay_250ms
019A   3003           00550         movlw   0x03
019B   00F3           00551         movwf   DLoop1
019C   3018           00552         movlw   0x18
019D   00F4           00553         movwf   DLoop2
019E   3002           00554         movlw   0x02
019F   00F5           00555         movwf   DLoop3
01A0                  00556 Delay_250ms_0
01A0   0BF3           00557         decfsz  DLoop1, f
01A1   2???           00558         goto    $+2
01A2   0BF4           00559         decfsz  DLoop2, f
01A3   2???           00560         goto    $+2
MPASM  5.52  /HOME/KWENDENARMO/MPLABXPROJECTS   10-18-2013  21:32:48         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01A4   0BF5           00561         decfsz  DLoop3, f
01A5   2???           00562         goto    Delay_250ms_0
01A6   2???           00563         goto    $+1
01A7   0008           00564         return
                      00565 
                      00566 ;------------------------------------------------------------------------------
                      00567 ;End of program
30C4                  00568     END
MPASM  5.52  /HOME/KWENDENARMO/MPLABXPROJECTS   10-18-2013  21:32:48         PAGE 13


SYMBOL TABLE
  LABEL                             VALUE 

ADC0_Accumulator_HI               0000004E
ADC0_Accumulator_LO               0000004F
ADC0_LPFReg1                      0000003E
ADC0_LPFReg10                     00000047
ADC0_LPFReg11                     00000048
ADC0_LPFReg12                     00000049
ADC0_LPFReg13                     0000004A
ADC0_LPFReg14                     0000004B
ADC0_LPFReg15                     0000004C
ADC0_LPFReg16                     0000004D
ADC0_LPFReg2                      0000003F
ADC0_LPFReg3                      00000040
ADC0_LPFReg4                      00000041
ADC0_LPFReg5                      00000042
ADC0_LPFReg6                      00000043
ADC0_LPFReg7                      00000044
ADC0_LPFReg8                      00000045
ADC0_LPFReg9                      00000046
ADC1_Accumulator_HI               0000006E
ADC1_Accumulator_LO               0000006F
ADC1_LPFReg1                      0000005E
ADC1_LPFReg10                     00000067
ADC1_LPFReg11                     00000068
ADC1_LPFReg12                     00000069
ADC1_LPFReg13                     0000006A
ADC1_LPFReg14                     0000006B
ADC1_LPFReg15                     0000006C
ADC1_LPFReg16                     0000006D
ADC1_LPFReg2                      0000005F
ADC1_LPFReg3                      00000060
ADC1_LPFReg4                      00000061
ADC1_LPFReg5                      00000062
ADC1_LPFReg6                      00000063
ADC1_LPFReg7                      00000064
ADC1_LPFReg8                      00000065
ADC1_LPFReg9                      00000066
ADCON0                            0000001F
ADCS0                             00000004
ADCS1                             00000005
ADCS2                             00000006
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
ALARM_STAT                        00000072
ANS0                              00000000
ANS1                              00000001
ANS2                              00000002
ANS3                              00000003
ANSEL                             0000009F
Alarm_TMax                        00000110
MPASM  5.52  /HOME/KWENDENARMO/MPLABXPROJECTS   10-18-2013  21:32:48         PAGE 14


SYMBOL TABLE
  LABEL                             VALUE 

Alarm_VMax                        000000F6
Alarm_VMin                        000000DC
Aux                               0000007B
C                                 00000000
CCP1CON                           00000015
CCP1IE                            00000005
CCP1IF                            00000005
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCPR1                             00000013
CCPR1H                            00000014
CCPR1L                            00000013
CHS0                              00000002
CHS1                              00000003
CHS2                              00000004
CINV                              00000004
CIS                               00000003
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON0                            00000019
CMCON1                            0000001A
CMIE                              00000003
CMIF                              00000003
CMSYNC                            00000000
COUT                              00000006
DC                                00000001
DC1B0                             00000004
DC1B1                             00000005
DLoop1                            00000073
DLoop2                            00000074
DLoop3                            00000075
Delay_250ms                       0000019A
Delay_250ms_0                     000001A0
Delay_4us                         0000018C
Delay_75ms                        0000018F
Delay_75ms_0                      00000193
Dutycycle_ADC0                    00000077
Dutycycle_ADC1                    00000078
Dutycycle_HI                      00000079
Dutycycle_LO                      0000007A
EEADR                             0000009B
EECON1                            0000009C
EECON2                            0000009D
EEDAT                             0000009A
EEDATA                            0000009A
EEIE                              00000007
EEIF                              00000007
F                                 00000001
FSR                               00000004
GIE                               00000007
MPASM  5.52  /HOME/KWENDENARMO/MPLABXPROJECTS   10-18-2013  21:32:48         PAGE 15


SYMBOL TABLE
  LABEL                             VALUE 

GO                                00000001
GO_DONE                           00000001
GO_NOT_DONE                       00000001
GP0                               00000000
GP1                               00000001
GP2                               00000002
GP3                               00000003
GP4                               00000004
GP5                               00000005
GPIE                              00000003
GPIF                              00000000
GPIO                              00000005
G_000                             00000071
G_016                             0000007B
G_033                             00000082
G_050                             00000087
G_066                             0000008C
G_083                             00000090
G_100                             00000093
HTS                               00000002
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IOC                               00000096
IOC0                              00000000
IOC1                              00000001
IOC2                              00000002
IOC3                              00000003
IOC4                              00000004
IOC5                              00000005
IOCA                              00000096
IOCA0                             00000000
IOCA1                             00000001
IOCA2                             00000002
IOCA3                             00000003
IOCA4                             00000004
IOCA5                             00000005
IRCF0                             00000004
IRCF1                             00000005
IRCF2                             00000006
IRP                               00000007
LPF_ADC_Read                      00000122
LTS                               00000001
Max_Temp                          00000026
Max_Volt                          00000093
Min_Volt                          0000006E
NOT_BOD                           00000000
NOT_DONE                          00000001
NOT_GPPU                          00000007
NOT_PD                            00000003
NOT_POR                           00000001
MPASM  5.52  /HOME/KWENDENARMO/MPLABXPROJECTS   10-18-2013  21:32:48         PAGE 16


SYMBOL TABLE
  LABEL                             VALUE 

NOT_T1SYNC                        00000002
NOT_TO                            00000004
OPTION_REG                        00000081
OSCCON                            0000008F
OSCTUNE                           00000090
OSFIE                             00000002
OSFIF                             00000002
OSTS                              00000003
PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PEIE                              00000006
PIE1                              0000008C
PIR1                              0000000C
PR2                               00000092
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
RD                                00000000
RP0                               00000005
RP1                               00000006
SBODEN                            00000004
SCS                               00000000
STATUS                            00000003
STATUS_ISR                        00000071
SWDTEN                            00000000
Set_Dutycycle                     0000017C
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1GE                              00000006
T1GINV                            00000007
T1GSS                             00000001
T1IE                              00000000
T1IF                              00000000
T1OSCEN                           00000003
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
T2IE                              00000001
T2IF                              00000001
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1                              0000000E
TMR1CS                            00000001
TMR1GE                            00000006
TMR1H                             0000000F
MPASM  5.52  /HOME/KWENDENARMO/MPLABXPROJECTS   10-18-2013  21:32:48         PAGE 17


SYMBOL TABLE
  LABEL                             VALUE 

TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISIO                            00000085
TRISIO0                           00000000
TRISIO1                           00000001
TRISIO2                           00000002
TRISIO3                           00000003
TRISIO4                           00000004
TRISIO5                           00000005
TUN0                              00000000
TUN1                              00000001
TUN2                              00000002
TUN3                              00000003
TUN4                              00000004
TmCount                           00000076
ULPWUE                            00000005
VCFG                              00000006
VR0                               00000000
VR1                               00000001
VR2                               00000002
VR3                               00000003
VRCON                             00000099
VREN                              00000007
VRR                               00000005
W                                 00000000
WDTCON                            00000018
WDTPS0                            00000001
WDTPS1                            00000002
WDTPS2                            00000003
WDTPS3                            00000004
WPU                               00000095
WPU0                              00000000
WPU1                              00000001
WPU2                              00000002
WPU4                              00000004
WPU5                              00000005
WPUA                              00000095
WPUA0                             00000000
WPUA1                             00000001
WPUA2                             00000002
WPUA4                             00000004
WPUA5                             00000005
WR                                00000001
MPASM  5.52  /HOME/KWENDENARMO/MPLABXPROJECTS   10-18-2013  21:32:48         PAGE 18


SYMBOL TABLE
  LABEL                             VALUE 

WREN                              00000002
WRERR                             00000003
W_ISR                             00000070
Z                                 00000002
_BOD_NSLEEP                       00003EFF
_BOD_OFF                          00003CFF
_BOD_ON                           00003FFF
_BOD_SBODEN                       00003DFF
_BOREN_NSLEEP                     00003EFF
_BOREN_OFF                        00003CFF
_BOREN_ON                         00003FFF
_BOREN_SBODEN                     00003DFF
_CONFIG                           00002007
_CPD_OFF                          00003FFF
_CPD_ON                           00003F7F
_CP_OFF                           00003FFF
_CP_ON                            00003FBF
_DEVID1                           00002006
_EC_OSC                           00003FFB
_EXTRC                            00003FFF
_EXTRCIO                          00003FFE
_EXTRC_OSC_CLKOUT                 00003FFF
_EXTRC_OSC_NOCLKOUT               00003FFE
_FCMEN_OFF                        000037FF
_FCMEN_ON                         00003FFF
_FOSC_EC                          00003FFB
_FOSC_EXTRCCLK                    00003FFF
_FOSC_EXTRCIO                     00003FFE
_FOSC_HS                          00003FFA
_FOSC_INTOSCCLK                   00003FFD
_FOSC_INTOSCIO                    00003FFC
_FOSC_LP                          00003FF8
_FOSC_XT                          00003FF9
_HS_OSC                           00003FFA
_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_IESO_OFF                         00003BFF
_IESO_ON                          00003FFF
_INTOSC                           00003FFD
_INTOSCIO                         00003FFC
_INTRC_OSC_CLKOUT                 00003FFD
_INTRC_OSC_NOCLKOUT               00003FFC
_LP_OSC                           00003FF8
_MAIN_PROG_0023                   00000023
_MAIN_PROG_002C                   0000002C
_MAIN_PROG_002F                   0000002F
_MAIN_PROG_0048                   00000048
_MAIN_PROG_007A                   0000007A
_MAIN_PROG_0082                   00000082
_MAIN_PROG_0086                   00000086
_MAIN_PROG_008A                   0000008A
MPASM  5.52  /HOME/KWENDENARMO/MPLABXPROJECTS   10-18-2013  21:32:48         PAGE 19


SYMBOL TABLE
  LABEL                             VALUE 

_MAIN_PROG_008E                   0000008E
_MAIN_PROG_0092                   00000092
_MAIN_PROG_00A0                   000000A0
_MAIN_PROG_00B3                   000000B3
_MAIN_PROG_00B8                   000000B8
_MAIN_PROG_00BA                   000000BA
_MAIN_PROG_00CC                   000000CC
_MAIN_PROG_00D0                   000000D0
_MAIN_PROG_00D4                   000000D4
_MAIN_PROG_0128                   00000128
_MAIN_PROG_012B                   0000012B
_MAIN_PROG_0132                   00000132
_MAIN_PROG_0140                   00000140
_MAIN_PROG_0154                   00000154
_MAIN_PROG_0157                   00000157
_MAIN_PROG_015F                   0000015F
_MAIN_PROG_016D                   0000016D
_MAIN_PROG_018C                   0000018C
_MAIN_PROG_018D                   0000018D
_MAIN_PROG_0194                   00000194
_MAIN_PROG_0197                   00000197
_MAIN_PROG_01A1                   000001A1
_MAIN_PROG_01A3                   000001A3
_MAIN_PROG_01A6                   000001A6
_MCLRE_OFF                        00003FDF
_MCLRE_ON                         00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FEF
_WDTE_OFF                         00003FF7
_WDTE_ON                          00003FFF
_WDT_OFF                          00003FF7
_WDT_ON                           00003FFF
_XT_OSC                           00003FF9
__12F683                          00000001
isr                               00000000
loop                              000000B2
main                              00000066
setup                             0000000D

Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :    10 reported,     0 suppressed

